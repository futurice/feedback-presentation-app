<link rel="import" href="/bower_components/polymer/polymer.html">
<link rel="import" href="/bower_components/font-roboto/roboto.html">
<link rel="import" href="/bower_components/core-scaffold/core-scaffold.html">
<link rel="import" href="/bower_components/core-header-panel/core-header-panel.html">
<link rel="import" href="/bower_components/core-menu/core-menu.html">
<link rel="import" href="/bower_components/core-menu/core-submenu.html">
<link rel="import" href="/bower_components/paper-item/paper-item.html">

<link rel="import" href="/seed-element-master/elements/x-sidebar-menu.html">
<link rel="import" href="/seed-element-master/elements/x-project-service.html">
<link rel="import" href="/seed-element-master/elements/x-questions-service.html">
<link rel="import" href="/seed-element-master/elements/x-project-answer-list.html">
<link rel="import" href="/seed-element-master/elements/x-questions-list.html">
<link rel="import" href="/bower_components/core-animation/web-animations.html">
<link rel="import" href="/seed-element-master/elements/question-average-element.html">
<script type="text/javascript" src="/bower_components/underscore/underscore.js"></script>  
<link href='http://fonts.googleapis.com/css?family=Quattrocento|Quattrocento+Sans' rel='stylesheet' type='text/css'>

<polymer-element name="x-app">
  <template>
    <style>
      :host {
        display: block;
       font-family: 'Quattrocento Sans', sans-serif;
      }
     #core_toolbar {
        text-align: center;
        z-index: 1;
        color: rgb(255, 255, 255);
        fill: rgb(255, 255, 255);
        background-color: rgba(0, 0, 0, 0.2);
      }
      #root-grid {
        position: absolute;
        top: 0;
        right: 0;
        bottom: 0;
        left: 0;
      }

      .menu-block
      {
        text-align:center;
      }
      
      .menuicon
      {
        height: 36px;
        width: 36px;
        margin: 20px;
        fill: white;
        stroke: white;
      }
      /* Main view's header bar */
      core-scaffold::shadow core-toolbar {
        background-color: #689f38;
        color: #fff;
      }

      /* Main view's background */
      core-scaffold::shadow [main] {
        background-color: #fafafa;
      }

      /* Menu panel's header bar */
      .panel--menu::shadow #mainPanel, .panel--menu core-toolbar {
        background-color: #fff;
      }

      /* Menu panel */
      .panel--menu {
        background-color: #fff;
      }

      core-scaffold .panel--menu /deep/ core-menu {
        margin: 0;
      }


      #sidebar
      {
        max-width: 0%;
        margin-top: 64px;
        color: #fff;
        cursor: pointer;
        
      }

      paper-item.core-selected {
        background-color: #dcedc8;
      }
      paper-item::shadow #ripple {
        color: #8bc34a;
      }
    </style>


      <x-project-service id="service" projects="{{ allProjects }}"></x-project-service>

      <div flex id="root-grid">
        <core-toolbar id="core_toolbar">
          <core-icon-button icon="menu" on-tap={{menu_button_tap}}></core-icon-button>
          <div vertical flex layout>
          <div flex layout>Futurice Feedback</div>
          </div>
        </core-toolbar>
        <div horizontal layout relative fit>
        <!--sidebar menu-->
        <div vertical flex justify layout id="sidebar">
          <div class="menu-block" horizontal layout flex center style="background-color: #c7c7c7">
            <object class="menuicon" data="/icons/search-icon.svg" type="image/svg+xml"></object>
            <div>
            <core-input placeholder="Filter projects" on-input={{onSearchInput}} flex></core-input>
            </div>
          </div>
          <div class="menu-block" on-tap={{averageMenuButtonTapped}} horizontal layout flex center style="background-color: #b6b6b6">
            <object class="menuicon" data='/icons/average-star.svg' type="image/svg+xml"></object>
            <div>Average Scores</div>
          </div>
          <div class="menu-block" on-tap={{hofMenuButtonTapped}} horizontal layout flex center style="background-color: #acacac">
            <object class="menuicon" data='/icons/trophy.svg' type="image/svg+xml"></object>
            <div>Projects</div>
          </div>
        </div>
        <x-project-answer-list flex center hidden?="{{!(selectedSectionNumber == 0)}}" projects="{{projects}}" availableSpace="{{availableSpaceForProjectCards}}" startIndex="{{firstProjectIndex}}"></x-project-answer-list>
        <question-average-element hidden?="{{!(selectedSectionNumber == 1)}}" projects={{projects}} flex center></question-average-element>
        </div>
      </div>


    </core-scaffold>
  </template>
  <script>
  Polymer('x-app', 
    {
    onSearchInput: function(event, detail, sender)
    {
      this.filter = sender.inputValue;
    },
    allProjects: [],
    filter: null,
    selectedSectionNumber: 0, 
    allProjectsChanged: function(oldvalue, newvalue)
    {
      this.projects = this.filterProjects(this.allProjects);
      this.firstProjectIndex = 0;
    },
    filterChanged: function(oldvalue, newvalue) {
      this.firstProjectIndex = 0;
       this.projects = this.filterProjects(this.allProjects);  
    },
    filterProjects: function(p) {
      if(this.filter != null) {
        var tmp_filter = this.filter;
        return _.filter(p, function(proj) {
          return proj.value.project_name.substring(0, tmp_filter.length) === tmp_filter;
        });
      }
      return p;
    },
    menuHidden: true,
    availableSpaceForProjectCards: 4,
    firstProjectIndex: 0,
    questionsSelected: false,
    menu_button_tap: function(event, detail, sender) {
      this.menuHidden = !this.menuHidden;
      var sidebar = this.$.sidebar;
      if(this.menuHidden) {
        var player = document.timeline.play(new Animation(sidebar, [
            {maxWidth: "25%"},
            {maxWidth: "0%"}
            ],
            {duration: 150, fill: 'forwards'}));
        }
      else {
        var player = document.timeline.play(new Animation(sidebar, [
            {maxWidth: "0%"},
            {maxWidth: "25%"}
            ],
            {duration: 150, fill: 'forwards'}));
        this.availableSpaceForProjectCards = 4;
        }
    },
    averageMenuButtonTapped: function(event, detail, sender) {
      this.selectedSectionNumber = 1;
    },
    hofMenuButtonTapped: function(event, detail, sender) {
      this.selectedSectionNumber = 0;
    },
    ready: function(){
    }
  });
  </script>
</polymer-element>
